<app-header></app-header>

<form (ngSubmit)="cadastrarDespesa()">
    <div class="main-panel">
        <div class="col-md-12" style="margin-top: 100px;">

            <div *ngIf="isApresentarMensagemSucesso == true" style="margin-top: 150px;">
                <div data-notify="container" class="col-10 col-xs-11 col-sm-4 alert alert-success" role="alert"
                    data-notify-position="top-right"
                    style="display: inline-block; margin: 0px auto; padding-left: 65px; position: fixed; transition: all 0.9s ease-in-out 0s; z-index: 1031; top: 20px; right: 20px;">
                    <button type="button" aria-hidden="true" class="close" data-notify="dismiss"
                        style="position: absolute; right: 10px; top: 5px; z-index: 1033;"><a
                            (click)="desabilitarMensagem()">×</a></button><span data-notify="icon"
                        class="fa fa-bell"></span> <span data-notify="title">Sistema Financeiro</span> <span
                        data-notify="message">Despesa Cadastrada com Sucesso!</span><a href="index.html" target="_blank"
                        data-notify="url"
                        style="background-image: url(&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&quot;); height: 100%; left: 0px; position: absolute; top: 0px; width: 100%; z-index: 1032;"></a>
                </div>
            </div>

            <div *ngIf="isApresentarMensagemErro == true" style="margin-top: 150px;">
                <div data-notify="container" class="col-10 col-xs-11 col-sm-4 alert alert-danger" role="alert"
                    data-notify-position="top-right"
                    style="display: inline-block; margin: 0px auto; padding-left: 65px; position: fixed; transition: all 0.9s ease-in-out 0s; z-index: 1031; top: 20px; right: 20px;">
                    <button type="button" aria-hidden="true" class="close" data-notify="dismiss"
                        style="position: absolute; right: 10px; top: 5px; z-index: 1033;"><a
                            (click)="desabilitarMensagem()">×</a></button><span data-notify="icon"
                        class="fa fa-bell"></span> <span data-notify="title">Sistema Financeiro</span> <span
                        data-notify="message">Erro ao tentar cadastrar a Despesa</span><a href="index.html"
                        target="_blank" data-notify="url"
                        style="background-image: url(&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&quot;); height: 100%; left: 0px; position: absolute; top: 0px; width: 100%; z-index: 1032;"></a>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Cadastro de Despesa {{categoriaDespesaModel.sigla == 'DFI' ? 'Fixa':
                        'Variável'}}</div>
                </div>
                <div class="card-body">

                    <div class="row">

                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label for="categoriaDespesa">Categoria de Despesa</label>
                                <select class="form-control" autofocus name="categoriaDespesa"
                                    (ngModelChange)="recuperarCodigoCategoriaDespesaModel($event)"
                                    [(ngModel)]="despesaModel.categoriaDespesa">
                                    <option [disabled]="true">Selecione</option>
                                    <option *ngFor="let categoria_despesa_ of categoriaDespesaModelList" [value]="categoria_despesa_.codigo"> {{categoria_despesa_.descricao}} </option>
                                </select>
                            </div>
                        </div>

                        <div *ngIf="despesaModel.categoriaDespesa != null"
                            [ngClass]="{'col-md-3 col-lg-3' : despesaModel.pessoaEstabelecimento == 'Outro', 'col-md-4 col-lg-4': despesaModel.pessoaEstabelecimento != 'Outro'}">
                            <div class="form-group">
                                <label for="pessoaEstabelecimento">Pessoa ou Estabelecimento</label>
                                <ng-autocomplete [data]="pessoaEstabelecimentoList"
                                    [searchKeyword]="pesquisarPessoaEstabelecimentoPorNome"
                                    [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate"
                                    name="pessoaEstabelecimento" [(ngModel)]="despesaModel.pessoaEstabelecimento">
                                </ng-autocomplete>
                                <ng-template #itemTemplate let-item><a [innerHTML]="item.nome"></a></ng-template>
                                <ng-template #notFoundTemplate let-notFound>
                                    <div [innerHTML]="notFound"></div>
                                </ng-template>
                            </div>
                        </div>

                        <div class="col-md-1 col-lg-1">
                            <div class="animated fadeIn" style="margin-top: 36px;">
                                <button type="button" data-toggle="modal"
                                    data-target="#cadastrarPessoaEstabelecimentoModal"
                                    class="btn btn-round btn-primary btn-border">+</button>
                            </div>
                        </div>

                        <div *ngIf="categoriaDespesaModel.sigla == 'DFI'" class="col-md-2 col-lg-2">
                            <div class="form-group">
                                <label for="dataVencimento">Data do Vencimento</label>
                                <input id="dataVencimento" type="text" name="dataVencimento"
                                    [(ngModel)]="despesaModel.dataVencimento" placeholder="DD/MM/AAAA"
                                    class="form-control form-control" />
                            </div>
                        </div>

                        <div *ngIf="despesaModel.categoriaDespesa != null"
                            [ngClass]="{'col-md-2 col-lg-2' : despesaModel.pessoaEstabelecimento == 'Outro', 'col-md-2 col-lg-2' : categoriaDespesaModel.sigla == 'DFI', 'col-md-4 col-lg-4' : categoriaDespesaModel.sigla == 'DVA'}">
                            <div class="form-group">
                                <label for="dataPagamento">Data do Pagamento</label>
                                <input id="dataPagamento" type="text" name="dataPagamento"
                                    [(ngModel)]="despesaModel.dataPagamento" placeholder="DD/MM/AAAA"
                                    class="form-control form-control" />
                            </div>
                        </div>

                    </div>

                    <div *ngIf="despesaModel.categoriaDespesa != null" class="row">

                        <div class="ng-autocomplete col-md-5 col-lg-5">
                            <div class="form-group">
                                <label for="produtoServico">Produto ou Serviço</label>
                                <ng-select [items]="produtoServicoSelectList" bindLabel="descricao"
                                    bindValue="descricao" placeholder="Selecione Produto ou Serviço" name="descricao"
                                    [(ngModel)]="produtoServicoModel.descricao" (change)="onChange($event)">
                                </ng-select>
                            </div>
                        </div>

                        <div class="col-md-1 col-lg-1">
                            <div class="animated fadeIn" style="margin-top: 36px;">
                                <button type="button" data-toggle="modal" data-target="#cadastrarProdutoServicoModal"
                                    class="btn btn-round btn-warning">&#43;</button>
                            </div>
                        </div>

                        <div *ngIf="categoriaDespesaModel.sigla == 'DVA'" class="col-md-2 col-lg-2">
                            <div class="form-group">
                                <label for="quantidade">Quantidade</label>
                                <select id="quantidade" name="quantidade"
                                    [(ngModel)]="produtoServicoOcorrenciaModel.quantidade" class="form-control">
                                    <option [disabled]="true">Selecione</option>
                                    <option
                                        *ngFor="let produto_servico_ocorrencia_ of produtoServicoOcorrenciaQuantidadeList"
                                        [value]="produto_servico_ocorrencia_.codigo">
                                        {{produto_servico_ocorrencia_.codigo}}</option>
                                </select>
                            </div>
                        </div>

                        <div
                            [ngClass]="{'col-md-2 col-lg-2' : categoriaDespesaModel.sigla == 'DVA', 'col-md-4 col-lg-4' : categoriaDespesaModel.sigla == 'DFI'}">
                            <div class="form-group">
                                <label for="valorUnitario">Valor Unitário</label>
                                <input id="valorUnitario" type="text" name="valorUnitario" [(ngModel)]="produtoServicoOcorrenciaModel.valorUnitario" placeholder="R$ 00,00"
                                    class="form-control form-control" />
                            </div>
                        </div>

                        <div class="col-md-2 col-lg-2">
                            <div class="animated fadeIn" style="margin-top: 36px;">
                                <button type="button" (click)="cadastrarProdutoServico(produtoServicoModel)"
                                    class="btn btn-round btn-warning">></button>
                            </div>
                        </div>

                    </div>

                    <div *ngIf="produtoServicoModelList.length > 0" class="row">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <td class="text-left" style="width: 270px;"><b>Produto ou Serviço</b></td>
                                    <td class="text-center">
                                        <strong>Valor Unitário</strong>
                                    </td>
                                    <td class="text-center">
                                        <strong>Quantidade</strong>
                                    </td>
                                    <td class="text-center">
                                        <strong>Valor Total</strong>
                                    </td>
                                    <td class="text-center">
                                        <strong>Ações</strong>
                                    </td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let produto_servico_model_ of produtoServicoModelList">
                                    <td class="text-left"> {{produto_servico_model_.descricao}} </td>
                                    <td class="text-center"> {{produto_servico_model_.valorUnitario | currency : "BRL": true}} </td>
                                    <td class="text-center"> {{produto_servico_model_.quantidade}} </td>
                                    <td class="text-center"> {{ produto_servico_model_.quantidade * produto_servico_model_.valorUnitario | currency : "BRL": true}} </td>
                                    <td class="text-center">
                                        <button type="button" (click)="removerProdutoServico(produto_servico_model_)" class="btn btn-warning btn-border"> Remover </button>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="text-center fw-bold">
                                    <h4>Total</h4>
                                </td>
                                <td colspan="5" class="text-center fw-bold">
                                    <h3>{{totalProdutoServico | currency : "BRL": true}}</h3>
                                </td>
                            </tfoot>
                        </table>
                    </div>

                    <div *ngIf="isProdutoServicoMultiplo" class="card-action">
                        <button [disabled]="produtoServicoModel.descricao == null"
                            (click)="cadastrarProdutoServico(produtoServicoModel)"
                            class="btn btn-secondary btn-xl btn-border col-md-12">
                            <b>Cadastrar Produto ou Serviço</b>
                        </button>
                    </div>

                    <div class="row">

                        <div class="col-md-4 col-lg-3">
                            <div class="form-group">
                                <label for="valorTotalDespesa">Valor Total da Despesa</label>
                                <input id="valorTotalDespesa" type="text" name="valorTotalDespesa"
                                    placeholder="R$ 00,00" class="form-control" />
                            </div>
                        </div>

                        <div class="col-md-4 col-lg-3">
                            <div class="form-group">
                                <label for="valorDescontoDespesa">Valor do Desconto</label>
                                <input id="valorDescontoDespesa" type="text" name="valorDescontoDespesa" placeholder="R$ 00,00" class="form-control" />
                            </div>
                        </div>

                        <div class="col-md-4 col-lg-3">
                            <div class="form-group">
                                <label for="valorFinalDespesa">Valor da Final da Despesa</label>
                                <input id="valorFinalDespesa" type="text" name="valorFinalDespesa"
                                    placeholder="R$ 00,00" class="form-control" />
                            </div>
                        </div>

                        <div class="col-md-4 col-lg-3">
                            <div class="form-group">
                                <label for="tipoCanalPagamento">Canal Pagamento</label>
                                <select class="form-control" name="formaPagamento" [(ngModel)]="tipoCanalPagamentoModel.descricao">
                                    <option [disabled]="true">Selecione</option>
                                    <option *ngFor="let tipo_canal_pagamento_ of tipoCanalPagamentoList" [value]="tipo_canal_pagamento_.codigo"> {{tipo_canal_pagamento_ == "TRANSACAO_FISICA" ? "Transação Física" : "Transação Online" }} </option>
                                </select>
                            </div>
                        </div>    

                    </div>

                    <div *ngIf="despesaModel.categoriaDespesa != null" class="row">

                        <div class="col-md-3 col-lg-2">
                            <div class="form-group">
                                <label for="responsavelPagamento">Responsável pelo Pagamento</label>
                                <select class="form-control" name="responsavelPagamento" [(ngModel)]="formaPagamentoDespesaModel.pessoaPagamento">
                                    <option [disabled]="true">Selecione</option>
                                    <option *ngFor="let pessoa_fisica_ of pessoaFisicaModelList" [ngValue]="pessoa_fisica_"> {{pessoa_fisica_.nome}} </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-3 col-lg-2">
                            <div class="form-group">
                                <label for="formaPagamento">Forma de Pagamento</label>
                                <select class="form-control" name="tipoFormaPagamento" (ngModelChange)="recuperarFormaPagamentoDespesaConfiguradaUsuario($event)" [(ngModel)]="formaPagamentoDespesaModel.tipoFormaPagamento">
                                    <option [disabled]="true">Selecione</option>
                                    <option *ngFor="let tipo_forma_pagamento_ of tipoFormaPagamentoList" [ngValue]="tipo_forma_pagamento_"> {{tipo_forma_pagamento_.descricao}} </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-4 col-lg-5">
                            <div class="form-group">
                                <label for="fontePagamento">Fonte do Pagamento</label>
                                <select class="form-control" name="fontePagamento" [(ngModel)]="fontePagamento">
                                    <option [disabled]="true">Selecione</option>
                                    <option *ngFor="let fonte_pagamento_ of fontePagamentoDTOList" [ngValue]="fonte_pagamento_.codigoCartaoBancario"> {{fonte_pagamento_.descricao}} </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-3 col-lg-2">
                            <div class="form-group">
                                <label for="valorPagamento">Valor do Pagamento</label>
                                <input id="valorPagamento" type="text" name="valorPagamento" [(ngModel)]="formaPagamentoDespesaModel.valorPagamento" placeholder="R$ 00,00" class="form-control" />
                            </div>
                        </div>

                        <div class="col-md-2 col-lg-1">
                            <div class="animated fadeIn" style="margin-top: 36px;">
                                <button type="button" (click)="cadastrarFormaPagamentoMultiplaDespesa()" class="btn btn-round btn-secondary">></button>
                            </div>
                        </div>

                    </div>

                    <div *ngIf="formaPagamentoDespesaModelList.length > 0" class="row">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <td class="text-left" style="width: 270px;"><b>Responsável Pelo Pagamento</b></td>
                                    <td class="text-center"><strong>Forma de Pagamento</strong></td>
                                    <td class="text-center"><strong>Fonte do Pagamento</strong></td>
                                    <td class="text-center"><strong>Valor do Pagamento</strong></td>
                                    <td class="text-center"><strong>Ações</strong></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let forma_pagamento_despesa_ of formaPagamentoDespesaModelList">
                                    <td> {{forma_pagamento_despesa_.pessoaPagamento.nome}} </td>
                                    <td class="text-center"> {{forma_pagamento_despesa_.tipoFormaPagamento.descricao}} </td>
                                    <td> {{forma_pagamento_despesa_.fontePagamento}} </td>
                                    <td class="text-center"> {{forma_pagamento_despesa_.valorPagamento | currency : "BRL": true }} </td>
                                    <td class="text-center"><button type="button" class="btn btn-warning btn-border"> Remover </button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
                <div class="card-action">
                    <button id="cadastrarDespesa" [disabled]="despesaModel.categoriaDespesa == null"
                        class="btn btn-primary btn-lg col-md-6" style="margin: 4px;">Cadastrar Despesa</button>
                    <button type="button" [disabled]="despesaModel.categoriaDespesa == null"
                        class="btn btn-warning btn-lg col-md-3" style="margin: 4px;">Cadastrar Outra</button>
                    <button type="button" (click)="redirecionarPaginaMonitoramentoDespesa()"
                        class="btn btn-danger btn-border btn-lg col-md-2" style="margin: 4px;">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</form>

<div id="cadastrarPessoaEstabelecimentoModal" class="modal animated fadeIn" tabindex="-1" role="dialog" focus>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cadastrar Pessoa ou Estabelecimento</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 col-lg-6">
                        <div class="form-group">
                            <label for="nome">Pessoa ou Estabelecimento</label>
                            <input type="text" name="nome" [(ngModel)]="pessoaModel.nome"
                                class="form-control form-control">
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-6">
                        <div class="form-group">
                            <label for="tipoPessoa">Tipo de Pessoa</label>
                            <select name="tipoPessoa" [(ngModel)]="pessoaModel.tipoPessoa" class="form-control"
                                placeholder="Selecione">
                                <option [disabled]="true">Selecione</option>
                                <option *ngFor="let tipo_pessoa_model_ of tipoPessoaModelList"
                                    [ngValue]="tipo_pessoa_model_">{{ tipo_pessoa_model_.descricao }}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" (click)="cadastrarPessoaEstabelecimento(pessoaModel)" data-dismiss="modal"
                    class="btn btn-primary col-md-10">Cadastrar</button>
                <button type="button" data-dismiss="modal"
                    class="btn btn-secondary btn-border col-md-2">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<div id="cadastrarProdutoServicoModal" class="modal animated fadeIn" tabindex="-1" role="dialog" focus>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cadastrar Produto ou Serviço</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-lg-12">
                        <div class="form-group">
                            <label for="descricao">Descrição do Produto ou Serviço</label>
                            <input type="text" name="descricao" [(ngModel)]="produtoServicoModel.descricao"
                                class="form-control form-control">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary col-md-10">Cadastrar</button>
                <button type="button" data-dismiss="modal"
                    class="btn btn-secondary btn-border col-md-2">Cancelar</button>
            </div>
        </div>
    </div>
</div>